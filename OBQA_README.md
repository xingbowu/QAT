# OpenBookQA è®­ç»ƒè„šæœ¬è¯´æ˜

## ğŸ“‹ æ–‡ä»¶ä¿¡æ¯

- **è„šæœ¬åç§°**: `run_obqa.sh`
- **æ•°æ®é›†**: OpenBookQA (Open Book Question Answering)
- **åˆ›å»ºæ—¥æœŸ**: 2024-11-14

## ğŸ¯ æ•°æ®é›†ç‰¹ç‚¹

OpenBookQA æ˜¯ä¸€ä¸ªåŸºäºç§‘å­¦äº‹å®çš„é—®ç­”æ•°æ®é›†ï¼Œç‰¹ç‚¹åŒ…æ‹¬ï¼š
- éœ€è¦ç§‘å­¦çŸ¥è¯†æ¨ç†
- åŒ…å« 4,957 ä¸ªé—®é¢˜
- 4ä¸ªé€‰é¡¹çš„å¤šé¡¹é€‰æ‹©é¢˜
- åŸºäºç§‘å­¦æ•™ç§‘ä¹¦çš„å¸¸è¯†çŸ¥è¯†

## ğŸ”§ ä¸ CommonsenseQA çš„å·®å¼‚

| é…ç½®é¡¹ | CommonsenseQA (csqa) | OpenBookQA (obqa) | è¯´æ˜ |
|--------|---------------------|-------------------|------|
| **æ•°æ®é›†** | csqa | obqa | æ•°æ®é›†åç§° |
| **ç¼–ç å™¨å­¦ä¹ ç‡** | 2e-5 | 1e-5 | obqa ä½¿ç”¨è¾ƒå°çš„å­¦ä¹ ç‡ |
| **æœ€å¤§åºåˆ—é•¿åº¦** | 88 | 100 | obqa é—®é¢˜å¯èƒ½ç¨é•¿ |
| **æ•°æ®æ¨¡å¼** | inhouse | official | obqa ä½¿ç”¨å®˜æ–¹åˆ’åˆ† |
| **æ—¥å¿—ç›®å½•** | logs/csqa | logs/obqa | ä¸åŒçš„æ—¥å¿—è·¯å¾„ |

## ğŸ“‚ ç›®å½•ç»“æ„

```
/data1/workspace/libo/QAT/
â”œâ”€â”€ run_csqa.sh          # CommonsenseQA è®­ç»ƒè„šæœ¬
â”œâ”€â”€ run_obqa.sh          # OpenBookQA è®­ç»ƒè„šæœ¬ (æ–°å»º)
â”œâ”€â”€ logs/
â”‚   â”œâ”€â”€ csqa/           # CommonsenseQA æ—¥å¿—
â”‚   â””â”€â”€ obqa/           # OpenBookQA æ—¥å¿— (æ–°å»º)
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ csqa -> /data1/dataset/qat_data/csqa
â”‚   â”œâ”€â”€ obqa -> /data1/dataset/qat_data/obqa  (æ–°å»º)
â”‚   â”œâ”€â”€ cpnet/
â”‚   â””â”€â”€ ddb/
â””â”€â”€ experiments/        # æ¨¡å‹ä¿å­˜ç›®å½•
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. è®­ç»ƒ OpenBookQA æ¨¡å‹

```bash
cd /data1/workspace/libo/QAT
bash run_obqa.sh
```

### 2. è‡ªå®šä¹‰å‚æ•°

å¯ä»¥ä¿®æ”¹ `run_obqa.sh` ä¸­çš„è¶…å‚æ•°ï¼š

```bash
# è®­ç»ƒè½®æ•°
n_epochs=30

# æ‰¹æ¬¡å¤§å°
bs=128          # æ€»æ‰¹æ¬¡å¤§å°
mbs=4           # mini batch size
ebs=8           # è¯„ä¼°æ‰¹æ¬¡å¤§å°

# å­¦ä¹ ç‡
elr="1e-5"      # ç¼–ç å™¨å­¦ä¹ ç‡
dlr="1e-4"      # è§£ç å™¨å­¦ä¹ ç‡

# æ¨¡å‹æ¶æ„
tr_dim=1024     # Transformerç»´åº¦
ffn_dim=2048    # FFNç»´åº¦
num_heads=16    # æ³¨æ„åŠ›å¤´æ•°
k=2             # Transformerå±‚æ•°

# æ­£åˆ™åŒ–
dropout="1e-1"
dropoutf="1e-1"
drop_ratio="0.05"
lambda="10"     # RPEæ­£åˆ™åŒ–ç³»æ•°
```

### 3. å¤šGPUè®­ç»ƒ

è„šæœ¬é»˜è®¤ä½¿ç”¨ GPU 6,7ï¼Œå¯ä»¥ä¿®æ”¹ï¼š

```bash
export CUDA_VISIBLE_DEVICES=0,1  # ä½¿ç”¨ GPU 0,1
export CUDA_VISIBLE_DEVICES=2    # ä»…ä½¿ç”¨ GPU 2
```

### 4. å¤šç§å­è®­ç»ƒ

ä¿®æ”¹è„šæœ¬ä¸­çš„å¾ªç¯ä»¥è¿è¡Œå¤šä¸ªéšæœºç§å­ï¼š

```bash
# åœ¨ run_obqa.sh ä¸­ä¿®æ”¹
for seed in 0 1 2; do  # è¿è¡Œ3ä¸ªä¸åŒçš„ç§å­
  python3 -u main_qat.py --dataset $dataset --seed $seed ...
done
```

## ğŸ“Š é¢„æœŸæ€§èƒ½

æ ¹æ®è®ºæ–‡ï¼ŒOpenBookQA çš„é¢„æœŸæ€§èƒ½ï¼š
- **å‡†ç¡®ç‡**: ~68-72%
- **è®­ç»ƒæ—¶é—´**: ~3-4å°æ—¶ (2x V100 GPU)
- **å†…å­˜å ç”¨**: ~16GB (FP16æ··åˆç²¾åº¦)

## ğŸ” æ•°æ®æ–‡ä»¶æ£€æŸ¥

éªŒè¯æ•°æ®æ–‡ä»¶æ˜¯å¦æ­£ç¡®ï¼š

```bash
# æ£€æŸ¥è¯­å¥æ–‡ä»¶
ls -lh data/obqa/statement/
# è¾“å‡ºåº”åŒ…å«:
# - train.statement.jsonl
# - dev.statement.jsonl
# - test.statement.jsonl

# æ£€æŸ¥å›¾æ–‡ä»¶
ls -lh data/obqa/graph/*.pk
# è¾“å‡ºåº”åŒ…å«:
# - train.graph.adj.ori2.metapath.2.q2a.seq.pk
# - dev.graph.adj.ori2.metapath.2.q2a.seq.pk
# - test.graph.adj.ori2.metapath.2.q2a.seq.pk
```

## ğŸ“ æ—¥å¿—æ–‡ä»¶

è®­ç»ƒæ—¥å¿—ä¿å­˜åœ¨ï¼š
```
logs/obqa/newFT_path.obqa_1e-5.1e-4.1e-2.1e-1_1024.2048.16__seed0_<timestamp>.log.txt
```

æ—¥å¿—åŒ…å«ï¼š
- æ¯ä¸ªepochçš„è®­ç»ƒæŸå¤±
- éªŒè¯é›†å‡†ç¡®ç‡
- æµ‹è¯•é›†å‡†ç¡®ç‡
- è®­ç»ƒæ—¶é—´ç»Ÿè®¡

## ğŸ¯ è®­ç»ƒè¾“å‡º

### æ¨¡å‹æ–‡ä»¶
```
./saved_models/qat/model.pt          # æœ€ä½³æ¨¡å‹
./saved_models/qat/config.json       # é…ç½®æ–‡ä»¶
./saved_models/qat/log.csv           # è®­ç»ƒæ—¥å¿—CSV
```

### é¢„æµ‹æ–‡ä»¶
```
./saved_models/qat/test_e<epoch>_preds.csv  # æµ‹è¯•é›†é¢„æµ‹ç»“æœ
```

## âš™ï¸ æ•…éšœæ’æŸ¥

### é—®é¢˜1: CUDA Out of Memory
**è§£å†³æ–¹æ¡ˆ**:
```bash
# å‡å°æ‰¹æ¬¡å¤§å°
bs=64
mbs=2
```

### é—®é¢˜2: æ•°æ®æ–‡ä»¶æ‰¾ä¸åˆ°
**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥ç¬¦å·é“¾æ¥
ls -la data/obqa

# é‡æ–°åˆ›å»ºé“¾æ¥
ln -sf /data1/dataset/qat_data/obqa data/obqa
```

### é—®é¢˜3: å­¦ä¹ ç‡è¿‡å¤§å¯¼è‡´ä¸æ”¶æ•›
**è§£å†³æ–¹æ¡ˆ**:
```bash
# é™ä½å­¦ä¹ ç‡
elr="5e-6"  # æ›´å°çš„ç¼–ç å™¨å­¦ä¹ ç‡
dlr="5e-5"  # æ›´å°çš„è§£ç å™¨å­¦ä¹ ç‡
```

## ğŸ“š å‚è€ƒèµ„æ–™

- **è®ºæ–‡**: Relation-aware Language-Graph Transformer for Question Answering (AAAI 2023)
- **OpenBookQA æ•°æ®é›†**: https://allenai.org/data/open-book-qa
- **é¡¹ç›®ä¸»é¡µ**: https://github.com/mlvlab/QAT

## ğŸ†š ä¸å…¶ä»–æ•°æ®é›†çš„å¯¹æ¯”

| æ•°æ®é›† | é—®é¢˜æ•° | é€‰é¡¹æ•° | çŸ¥è¯†æ¥æº | æ¨èå­¦ä¹ ç‡ |
|--------|--------|--------|----------|-----------|
| **CommonsenseQA** | 12,247 | 5 | ConceptNet | 2e-5 |
| **OpenBookQA** | 4,957 | 4 | ç§‘å­¦äº‹å® | 1e-5 |
| **MedQA-USMLE** | 12,723 | 4 | åŒ»å­¦çŸ¥è¯† | 5e-5 |

## ğŸ’¡ æœ€ä½³å®è·µ

1. **é¦–æ¬¡è®­ç»ƒ**: ä½¿ç”¨é»˜è®¤å‚æ•°
2. **è°ƒä¼˜é˜¶æ®µ**: å°è¯•ä¸åŒçš„å­¦ä¹ ç‡å’Œdropout
3. **å¤šæ¬¡è¿è¡Œ**: ä½¿ç”¨å¤šä¸ªéšæœºç§å­å–å¹³å‡
4. **ç›‘æ§è®­ç»ƒ**: å®šæœŸæ£€æŸ¥æ—¥å¿—æ–‡ä»¶
5. **æ—©åœç­–ç•¥**: å¦‚æœ10ä¸ªepochæ²¡æœ‰æå‡åˆ™åœæ­¢

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒï¼š
- `design.md` - å®Œæ•´çš„ä»£ç é€»è¾‘æ–‡æ¡£
- `README.md` - é¡¹ç›®æ€»ä½“è¯´æ˜
- GitHub Issues - æŠ¥å‘Šé—®é¢˜

---

**æœ€åæ›´æ–°**: 2024-11-14  
**è„šæœ¬ç‰ˆæœ¬**: v1.0

